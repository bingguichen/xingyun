<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dstz.adaptor.org.xingyun.dao.GroupDao">
  <resultMap id="DeptDto" type="com.dstz.adaptor.org.xingyun.dto.DeptDTO">
    <id property="groupId" column="id" jdbcType="VARCHAR"/>
    <result property="groupName" column="name" jdbcType="VARCHAR"/>
    <result property="groupCode" column="username" jdbcType="VARCHAR"/>
    <result property="parentId" column="parent_id" jdbcType="VARCHAR"/>
  </resultMap>

  <resultMap id="RoleDto" type="com.dstz.adaptor.org.xingyun.dto.RoleDTO">
    <id property="groupId" column="id" jdbcType="VARCHAR"/>
    <result property="groupName" column="name" jdbcType="VARCHAR"/>
    <result property="groupCode" column="username" jdbcType="VARCHAR"/>
    <result property="parentId" column="parent_id" jdbcType="VARCHAR"/>
  </resultMap>

  <resultMap id="PositionDto" type="com.dstz.adaptor.org.xingyun.dto.PositionDTO">
    <id property="groupId" column="id" jdbcType="VARCHAR"/>
    <result property="groupName" column="name" jdbcType="VARCHAR"/>
    <result property="groupCode" column="username" jdbcType="VARCHAR"/>
    <result property="parentId" column="parent_id" jdbcType="VARCHAR"/>
  </resultMap>

  <select id="getDeptByUserId" resultMap="DeptDto">
    SELECT d.id, d.name, d.code, d.parent_id
    FROM sys_user_dept AS ud
           INNER JOIN sys_user AS u ON u.id = ud.user_id
           INNER JOIN sys_dept AS d ON d.id = ud.dept_id
    WHERE ud.user_id = #{userId}
      AND d.available = TRUE
    ORDER BY d.code
  </select>

  <select id="getRoleByUserId" resultMap="RoleDto">
    SELECT r.id, r.name, r.code, NULL AS parent_id
    FROM sys_user_role AS ur
           INNER JOIN sys_user AS u ON u.id = ur.user_id
           INNER JOIN sys_role AS r ON r.id = ur.role_id
    WHERE ur.user_id = #{userId}
      AND r.available = TRUE
    ORDER BY r.code
  </select>

  <select id="getPositionByUserId" resultMap="PositionDto">
    SELECT p.id, p.name, p.code, NULL AS parent_id
    FROM sys_user_position AS up
           INNER JOIN sys_user AS u ON u.id = up.user_id
           INNER JOIN sys_position AS p ON p.id = up.position_id
    WHERE up.user_id = #{userId}
      AND p.available = TRUE
    ORDER BY p.code
  </select>

  <select id="getDeptById" resultMap="DeptDto">
    SELECT id, name, code, parent_id
    FROM sys_dept
    WHERE id = #{id}
  </select>

  <select id="getRoleById" resultMap="RoleDto">
    SELECT id, name, code, NULL AS parent_id
    FROM sys_role
    WHERE id = #{id}
  </select>

  <select id="getPositionById" resultMap="PositionDto">
    SELECT id, name, code, NULL AS parent_id
    FROM sys_position
    WHERE id = #{id}
  </select>

  <select id="getDeptByCode" resultMap="DeptDto">
    SELECT id, name, code, parent_id
    FROM sys_dept
    WHERE code = #{code}
  </select>

  <select id="getRoleByCode" resultMap="RoleDto">
    SELECT id, name, code, NULL AS parent_id
    FROM sys_role
    WHERE code = #{code}
  </select>

  <select id="getPositionByCode" resultMap="PositionDto">
    SELECT id, name, code, NULL AS parent_id
    FROM sys_position
    WHERE code = #{code}
  </select>
</mapper>